<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إدارة منتجات العطور</title>
  <!-- Bootstrap 5 RTL CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .card-img-top {
      height: 200px;
      object-fit: cover;
    }

    .form-control:required:invalid {
      border-color: #dc3545;
    }

    .form-control:required:valid {
      border-color: #28a745;
    }
  </style>
</head>

<body>
  <div class="container py-5">
    <h1 class="text-center mb-5">إدارة منتجات العطور</h1>

    <div class="d-flex justify-content-between mb-4">
      <h2>قائمة المنتجات</h2>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
        <i class="fas fa-plus"></i> إضافة منتج جديد
      </button>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>الصورة</th>
            <th>الاسم</th>
            <th>السعر</th>
            <th>الفئة</th>
            <th>الأكثر مبيعاً</th>
            <th>الإجراءات</th>
          </tr>
        </thead>
        <tbody id="productsTable">
          <!-- Products will be loaded here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add Product Modal -->
  <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addProductModalLabel">إضافة منتج جديد</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="addProductForm" novalidate>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="addName" class="form-label">اسم المنتج</label>
                <input type="text" class="form-control" id="addName" required>
                <div class="invalid-feedback">يرجى إدخال اسم المنتج</div>
              </div>
              <div class="col-md-6">
                <label for="addPrice" class="form-label">السعر (EGP)</label>
                <input type="number" class="form-control" id="addPrice" min="0" step="0.01" required>
                <div class="invalid-feedback">يرجى إدخال سعر صحيح</div>
              </div>
              <div class="col-md-6">
                <label for="addCategory" class="form-label">الفئة</label>
                <select class="form-select" id="addCategory" required>
                  <option value="">اختر الفئة</option>
                  <option value="man">رجالي</option>
                  <option value="women">نسائي</option>
                </select>
                <div class="invalid-feedback">يرجى اختيار الفئة</div>
              </div>
              <div class="col-md-6">
                <label for="addDiscount" class="form-label">الخصم (%)</label>
                <input type="number" class="form-control" id="addDiscount" min="0" max="100" value="0">
              </div>
              <div class="col-md-12">
                <label for="addDescription" class="form-label">الوصف</label>
                <textarea class="form-control" id="addDescription" rows="3" required></textarea>
                <div class="invalid-feedback">يرجى إدخال وصف المنتج</div>
              </div>
              <div class="col-md-12">
                <label for="addImage" class="form-label">رابط الصورة</label>
                <input type="url" class="form-control" id="addImage" required>
                <div class="invalid-feedback">يرجى إدخال رابط صحيح للصورة</div>
              </div>
              <div class="col-md-12">
                <label for="addMetaDesc" class="form-label">وصف SEO</label>
                <textarea class="form-control" id="addMetaDesc" rows="2" required></textarea>
                <div class="invalid-feedback">يرجى إدخال وصف SEO</div>
              </div>
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="addBestSeller">
                  <label class="form-check-label" for="addBestSeller">الأكثر مبيعاً</label>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
            <button type="submit" class="btn btn-primary">حفظ المنتج</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Product Modal -->
  <div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editProductModalLabel">تعديل المنتج</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="editProductForm" novalidate>
          <input type="hidden" id="editId">
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="editName" class="form-label">اسم المنتج</label>
                <input type="text" class="form-control" id="editName" required>
                <div class="invalid-feedback">يرجى إدخال اسم المنتج</div>
              </div>
              <div class="col-md-6">
                <label for="editPrice" class="form-label">السعر (EGP)</label>
                <input type="number" class="form-control" id="editPrice" min="0" step="0.01" required>
                <div class="invalid-feedback">يرجى إدخال سعر صحيح</div>
              </div>
              <div class="col-md-6">
                <label for="editCategory" class="form-label">الفئة</label>
                <select class="form-select" id="editCategory" required>
                  <option value="">اختر الفئة</option>
                  <option value="man">رجالي</option>
                  <option value="women">نسائي</option>
                </select>
                <div class="invalid-feedback">يرجى اختيار الفئة</div>
              </div>
              <div class="col-md-6">
                <label for="editDiscount" class="form-label">الخصم (%)</label>
                <input type="number" class="form-control" id="editDiscount" min="0" max="100">
              </div>
              <div class="col-md-12">
                <label for="editDescription" class="form-label">الوصف</label>
                <textarea class="form-control" id="editDescription" rows="3" required></textarea>
                <div class="invalid-feedback">يرجى إدخال وصف المنتج</div>
              </div>
              <div class="col-md-12">
                <label for="editImage" class="form-label">رابط الصورة</label>
                <input type="url" class="form-control" id="editImage" required>
                <div class="invalid-feedback">يرجى إدخال رابط صحيح للصورة</div>
              </div>
              <div class="col-md-12">
                <label for="editMetaDesc" class="form-label">وصف SEO</label>
                <textarea class="form-control" id="editMetaDesc" rows="2" required></textarea>
                <div class="invalid-feedback">يرجى إدخال وصف SEO</div>
              </div>
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="editBestSeller">
                  <label class="form-check-label" for="editBestSeller">الأكثر مبيعاً</label>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
            <button type="submit" class="btn btn-primary">حفظ التعديلات</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteProductModal" tabindex="-1" aria-labelledby="deleteProductModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteProductModalLabel">تأكيد الحذف</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>هل أنت متأكد أنك تريد حذف هذا المنتج؟ لا يمكن التراجع عن هذا الإجراء.</p>
          <input type="hidden" id="deleteId">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
          <button type="button" class="btn btn-danger" id="confirmDelete">حذف</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap & Firebase JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "guzel-1f032.firebaseapp.com",
      databaseURL: "https://guzel-1f032-default-rtdb.firebaseio.com",
      projectId: "guzel-1f032",
      storageBucket: "guzel-1f032.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const productsRef = database.ref('products');

    // Load products on page load
    document.addEventListener('DOMContentLoaded', loadProducts);

    function loadProducts() {
      productsRef.on('value', (snapshot) => {
        const products = snapshot.val();
        const tableBody = document.getElementById('productsTable');
        tableBody.innerHTML = '';

        if (products) {
          Object.keys(products).forEach(key => {
            const product = products[key];
            const row = document.createElement('tr');

            row.innerHTML = `
                            <td><img src="${product.image}" alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover;"></td>
                            <td>${product.name}</td>
                            <td>${product.price} EGP</td>
                            <td>${product.category === 'man' ? 'رجالي' : 'نسائي'}</td>
                            <td>${product.best_seller ? '<i class="fas fa-check text-success"></i>' : '<i class="fas fa-times text-danger"></i>'}</td>
                            <td>
                                <button class="btn btn-sm btn-warning edit-btn" data-id="${key}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-btn" data-id="${key}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;

            tableBody.appendChild(row);
          });

          // Add event listeners to edit buttons
          document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              const productId = btn.getAttribute('data-id');
              editProduct(productId);
            });
          });

          // Add event listeners to delete buttons
          document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              const productId = btn.getAttribute('data-id');
              document.getElementById('deleteId').value = productId;
              const deleteModal = new bootstrap.Modal(document.getElementById('deleteProductModal'));
              deleteModal.show();
            });
          });
        } else {
          tableBody.innerHTML = '<tr><td colspan="6" class="text-center">لا توجد منتجات متاحة</td></tr>';
        }
      });
    }

    // Add new product
    document.getElementById('addProductForm').addEventListener('submit', (e) => {
      e.preventDefault();

      if (validateForm('addProductForm')) {
        const newProduct = {
          name: document.getElementById('addName').value,
          description: document.getElementById('addDescription').value,
          price: parseFloat(document.getElementById('addPrice').value),
          discount: parseInt(document.getElementById('addDiscount').value) || 0,
          image: document.getElementById('addImage').value,
          category: document.getElementById('addCategory').value,
          meta_desc: document.getElementById('addMetaDesc').value,
          best_seller: document.getElementById('addBestSeller').checked
        };

        productsRef.push(newProduct)
          .then(() => {
            alert('تمت إضافة المنتج بنجاح');
            document.getElementById('addProductForm').reset();
            bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
          })
          .catch(error => {
            console.error('Error adding product: ', error);
            alert('حدث خطأ أثناء إضافة المنتج');
          });
      }
    });

    // Edit product
    function editProduct(productId) {
      productsRef.child(productId).once('value', (snapshot) => {
        const product = snapshot.val();

        document.getElementById('editId').value = productId;
        document.getElementById('editName').value = product.name;
        document.getElementById('editDescription').value = product.description;
        document.getElementById('editPrice').value = product.price;
        document.getElementById('editDiscount').value = product.discount || 0;
        document.getElementById('editImage').value = product.image;
        document.getElementById('editCategory').value = product.category;
        document.getElementById('editMetaDesc').value = product.meta_desc;
        document.getElementById('editBestSeller').checked = product.best_seller || false;

        const editModal = new bootstrap.Modal(document.getElementById('editProductModal'));
        editModal.show();
      });
    }

    // Update product
    document.getElementById('editProductForm').addEventListener('submit', (e) => {
      e.preventDefault();

      if (validateForm('editProductForm')) {
        const productId = document.getElementById('editId').value;
        const updatedProduct = {
          name: document.getElementById('editName').value,
          description: document.getElementById('editDescription').value,
          price: parseFloat(document.getElementById('editPrice').value),
          discount: parseInt(document.getElementById('editDiscount').value) || 0,
          image: document.getElementById('editImage').value,
          category: document.getElementById('editCategory').value,
          meta_desc: document.getElementById('editMetaDesc').value,
          best_seller: document.getElementById('editBestSeller').checked
        };

        productsRef.child(productId).update(updatedProduct)
          .then(() => {
            alert('تم تحديث المنتج بنجاح');
            bootstrap.Modal.getInstance(document.getElementById('editProductModal')).hide();
          })
          .catch(error => {
            console.error('Error updating product: ', error);
            alert('حدث خطأ أثناء تحديث المنتج');
          });
      }
    });

    // Delete product
    document.getElementById('confirmDelete').addEventListener('click', () => {
      const productId = document.getElementById('deleteId').value;

      productsRef.child(productId).remove()
        .then(() => {
          alert('تم حذف المنتج بنجاح');
          bootstrap.Modal.getInstance(document.getElementById('deleteProductModal')).hide();
        })
        .catch(error => {
          console.error('Error deleting product: ', error);
          alert('حدث خطأ أثناء حذف المنتج');
        });
    });

    // Form validation
    function validateForm(formId) {
      const form = document.getElementById(formId);
      let isValid = true;

      // Check all required fields
      form.querySelectorAll('[required]').forEach(input => {
        if (!input.value.trim())

          if (!input.value.trim()) {
            input.classList.add('is-invalid');
            isValid = false;
          } else {
            input.classList.remove('is-invalid');
          }
      });

      // Special validation for URLs
      const urlInputs = form.querySelectorAll('input[type="url"]');
      urlInputs.forEach(input => {
        try {
          new URL(input.value);
          input.classList.remove('is-invalid');
        } catch (e) {
          input.classList.add('is-invalid');
          isValid = false;
        }
      });

      return isValid;
    }

    // Reset validation when modal is shown
    document.getElementById('addProductModal').addEventListener('show.bs.modal', () => {
      document.getElementById('addProductForm').querySelectorAll('.is-invalid').forEach(el => {
        el.classList.remove('is-invalid');
      });
    });

    document.getElementById('editProductModal').addEventListener('show.bs.modal', () => {
      document.getElementById('editProductForm').querySelectorAll('.is-invalid').forEach(el => {
        el.classList.remove('is-invalid');
      });
    });

    // Live validation
    document.querySelectorAll('#addProductForm [required]').forEach(input => {
      input.addEventListener('input', () => {
        if (input.value.trim()) {
          input.classList.remove('is-invalid');
        }
      });
    });

    document.querySelectorAll('#editProductForm [required]').forEach(input => {
      input.addEventListener('input', () => {
        if (input.value.trim()) {
          input.classList.remove('is-invalid');
        }
      });
    });
  </script>
</body>

    <script src="main.js"></script>
  </body>
</html>